#!/usr/bin/env python3
"""NFTop Module

main:
    calling the main function
"""

import math
from nftables import Nftables
from nftables import json


def convert_size(size_bytes):
    """Convert the sizes"""
    if size_bytes == 0:
        return 0, "B"
    size_name = ("B", "KiB", "MiB", "GiB", "TiB", "PiB", "EiB", "ZiB", "YiB")
    i = int(math.floor(math.log(size_bytes, 1024)))
    powered = math.pow(1024, i)
    size = round(size_bytes / powered, 2)
    return size, size_name[i]


def main():
    """Main function"""
    nft = Nftables()
    nft.set_json_output(True)
    _, output, _ = nft.cmd("list counters")
    if output == "":
        print("Please run as root.")
        return
    j = json.loads(output)

    print(f"{'Counter Name':>25}  {'Size':>10}"
          f"  {'Bytes':>10}  {'Packets':>10}")
    print(f"{'':->25}  {'':->10}  {'':->10}  {'':->10}")
    for i in range(len(j['nftables'])):
        if i == 0:
            continue
        counter = j['nftables'][i]["counter"]
        packets = counter["packets"]
        name = counter["name"]
        counter_bytes = counter["bytes"]
        count, count_name = convert_size(counter_bytes)
        print(f"{name:>25}  {count:>6.1f} {count_name:<3}  "
              f"{counter_bytes:>10}  {packets:>10,}")


if __name__ == "__main__":
    main()
