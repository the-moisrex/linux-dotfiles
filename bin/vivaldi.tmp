#!/bin/bash

if ! command -v vivaldi >/dev/null; then
    echo "Vivaldi is not installed or it's not in the PATH";
    exit 1;
fi

# Vivaldi-specific command line options
vivaldi_default_opts=(
    --no-remote
    --no-first-run
    --no-referrers
    --save-page-as-mhtml
    --no-default-browser-check
    --disable-sync
    --ignore-certificate-errors
    --disable-webrtc
    --disable-extensions
)

tor_cmds=()
case $1 in
	--tor|tor)
        if [ -z "$2" ]; then
            port="9050";
        else
            port="$2";
            shift;
        fi;
		tor_cmds=(--proxy-server="socks5://127.0.0.1:$port")
		shift
		;;
esac

dir=$(mktemp -d)
echo "Vivaldi Config Directory: $dir"

vivaldi "${vivaldi_default_opts[@]}" --user-data-dir="$dir" "${tor_cmds[@]}" "$@"
rm -rf "$dir"
echo "Vivaldi Config Directory $dir Deleted."
