#!/bin/bash

function print_help {
    echo "sigall -stop java   # pauses the app"
    echo "       -cont java   # resume the app"
    echo "       cont java    # works without any - in front of it as well"
    echo "       --help|-h"
}

sig="$1"
shift

if [ -z "$sig" ]; then
    print_help;
    exit;
fi

case $sig in
    --help|-h)
        print_help;
        exit;
        ;;
    -*)
        sig="${sig:1}"
        ;;
esac

if ! killall -l | grep -wqsi $sig; then
    echo "'$sig' is not a valid signal;"
    echo "Use one of these signals: "
    killall -l | xargs echo;
    exit;
fi

# while [ -n "$1" ]; do
#     pgid=$(ps -o pgid= $(pidof $1) | grep -o '[0-9]*')
#     echo "Sending '$sig' to $1 (PGID: $pgid)"
#     kill -s $sig -- -$pgid;
#     shift;
# done

space=""
killtree() {
    local _pid=$1
    # kill -stop ${_pid} # needed to stop quickly forking parent from producing children between child killing and parent killing
    for _child in $(ps -o pid --no-headers --ppid ${_pid}); do
        space="${space}  "
        killtree ${_child} ${_sig}
        space="${space:2}"
    done
    echo "${space}Sending '$sig' to $_pid"
    kill -s $sig ${_pid}
}

while [ -n "$1" ]; do
    pidlist=$(pidof $1)
    if [ -z "$pidlist" ]; then
        echo "Process '$1' not found; ignored."
        shift;
        continue;
    fi
    for pid in $pidlist; do
        killtree $pid
    done
    shift;
done


